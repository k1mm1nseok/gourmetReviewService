# 리뷰 정책 v1.3.3 사양서

**문서 버전:** 1.3.3
**최초 작성일:** 2025-12-31
**최종 수정일:** 2025-12-31
**대상 플랫폼:** 한국형 미식 검증 플랫폼 (Gourmet Review Service)

> 이 문서는 `review-policy-v1.3.2.md`를 기반으로, 2025-12-31 기준 구현 상태(P0) 및 운영 가이드를 반영한 *문서 버전 업그레이드*입니다.
> 정책/알고리즘의 큰 방향을 바꾸기보다, "문서-코드 불일치"를 제거하고 운영/프론트 계약(블라인드 마스킹 등)을 명확히 하는 목적입니다.

---

## 목차

1. [변경 요약 (v1.3.2 -> v1.3.3)](#1-변경-요약-v132---v133)
2. [점수 체계](#2-점수-체계)
3. [블라인드 정책](#3-블라인드-정책)
4. [극단 점수 쿨다운](#4-극단-점수-쿨다운)
5. [편차 보정(Deviation Target)](#5-편차-보정deviation-target)
6. [티어 변경 소급 반영](#6-티어-변경-소급-반영)
7. [관리자 수동 변경(운영 도구)](#7-관리자-수동-변경운영-도구)
8. [테스트/운영 가이드](#8-테스트운영-가이드)

---

## 1. 변경 요약 (v1.3.2 -> v1.3.3)

### 1.1 문서 버전 업그레이드의 성격
- **문서 버전 업그레이드**이며, “정책의 큰 방향 전환”이 목적은 아닙니다.
- 다만, P0 구현(쿨다운/편차보정 배치/티어 소급/블라인드 마스킹/관리자 API)이 문서에 반영됩니다.

### 1.2 핵심 변경사항
- **(신규) 블라인드 스토어 점수 마스킹 범위 확장**
  - 스토어 상세의 recentReviews 뿐 아니라, **리뷰 상세/리스트에서도 점수(score*)를 노출하지 않음**
- **(신규) 극단 점수(1.0/5.0) 쿨다운 12시간**
  - BRONZE/SILVER의 1.0/5.0 리뷰는 12시간 동안 `PENDING` 유지 후 자동 승인 배치 처리
- **(신규) 편차 보정 대상 자동 산정 배치**
  - 최근 PUBLIC 20개 중 1.0/5.0 비율이 90% 이상이면 deviation target
- **(신규) 티어 변경 소급 반영 트리거**
  - 회원 tier 변경 시, 해당 회원의 PUBLIC 리뷰가 반영된 스토어 점수 재계산 트리거
- **(신규) 관리자 수동 변경 API**
  - 운영 목적: member tier/role 변경

---

## 2. 점수 체계

### 2.1 개별 항목 점수
- 맛/가성비/분위기/서비스 점수는 현재 정책(프로덕트 합의)에 따라 운영합니다.
- (참고) “0.5 단위” 입력 정책 등은 추후 버전에서 명시적으로 반영 가능합니다.

### 2.2 리뷰 종합점수(scoreCalculated)
- 엔티티에서 자동 계산.
- 가중치(문서/코드 일치): **맛 40% / 가성비 30% / 분위기 15% / 서비스 15%**

### 2.3 스토어 점수(가게 평점)
- 저장 컬럼:
  - `store.scoreWeighted`: 정책 기반 가중/보정 후 최종 점수(프론트 노출 점수)
  - `store.avgRating`: 단순 평균(내부 참고/비교 지표)
- 베이지안 보정(prior m, C)을 적용하며, 목표는 “평범한 가게가 3.0 근처로 수렴”하도록 분포를 안정화하는 것.

---

## 3. 블라인드 정책

### 3.1 블라인드 기준
- 유효 리뷰 수(`reviewCountValid`)가 5 미만이면 블라인드.

### 3.2 블라인드 시 프론트 노출 규칙(계약)
- 스토어/리뷰 모든 응답에서 스토어가 블라인드면:
  - 점수 필드(`scoreWeighted`, `avgRating`, 리뷰의 `score*`, `scoreCalculated`)는 **null** 로 내려간다.
  - 텍스트(title/content), 이미지 등은 노출 가능.

---

## 4. 극단 점수 쿨다운

### 4.1 극단 점수 정의
- 극단 점수는 **1.0 / 5.0**만을 의미한다.
  - (1.5/4.5 등은 극단으로 취급하지 않음)

### 4.2 쿨다운 규칙
- 대상: BRONZE/SILVER
- 조건: 리뷰 종합점수(`scoreCalculated`)가 1.0 또는 5.0
- 처리: 작성 후 12시간 동안 `PENDING` 유지
- 만료 후 배치가 자동 승인 처리

---

## 5. 편차 보정(Deviation Target)

### 5.1 자동 산정 배치
- 최근 PUBLIC 리뷰 20개 기준
- 1.0/5.0 비율이 90% 이상이면 deviation target 플래그 `TRUE`

### 5.2 영향
- deviation target 사용자의 점수는 3.0 방향으로 보정(±0.5 범위)

---

## 6. 티어 변경 소급 반영

- 회원 tier 변경 시, 해당 회원의 PUBLIC 리뷰가 반영된 스토어 점수 재계산이 필요.
- 운영/관리자 변경, 자동 승급/강등 모두 동일한 트리거 경로로 정합성을 유지한다.

---

## 7. 관리자 수동 변경(운영 도구)

- API:
  - `PATCH /admin/members/{memberId}/tier` body: `{ "tier": "GOLD" }`
  - `PATCH /admin/members/{memberId}/role` body: `{ "role": "ADMIN" }`

> Spring Security 레벨의 RBAC 강화는 보안 작업으로 별도 진행.

---

## 8. 테스트/운영 가이드

- 기본 `mvn test`에서는 느린 시뮬레이션 테스트(`@Tag("slow")`)는 제외한다.
- 시뮬레이션은 필요할 때만 단독 실행한다.

